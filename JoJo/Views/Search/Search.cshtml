@model JoJo.Models.CatSubModel

@{
    Layout = "~/Views/Search/SearchLayout.cshtml";
}

<style>
    body {
    }

    #catI {
        display: inline-block;
    }

    #subI {
        display: inline-block;
    }

    #sI {
        display: inline-block;
    }

    #content {
        padding-left: 29%;
    }
    /*#close-image
        {
            width:30px;
        }*/

    .styled-select {
        background: no-repeat right center;
        height: 29px;
        overflow: hidden;
        width: 240px;
        background-color: #6cb9e9;
    }
</style>

<br /><br />
<div class="center-div" id="content">
    @using (@Html.BeginForm("Filter", "Filter", FormMethod.Get))
    {

        <div class="form-group" id="catI">

            @if (ViewBag.prodCat != null)
            {
                @Html.DropDownListFor(model => model.CategoryId, ViewBag.prodCat as SelectList, "--Select Category--", new { @class = "styled-select", @Name = "CategoryID" })
            }
        </div>
        <div class="form-group" id="subI">
            <div>
                @Html.TextBox("txtempname", null, new { @class = "form-control tbox", @Name = "SubCategoryName" })
            </div>
        </div>
        <div class="form-group" id="sI">
            <div>
                <input type="image" id="close-image" src="~/Src/Srch/pls.png" height="20" />
            </div>
        </div>
    }
</div>

<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.8.0.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.22/jquery-ui.js"></script>
<script>
    var id;
    $(document).ready(function () {
        $("#CategoryId").change(function () {
            id = $(this).val();
            $("#SubCategoryId").empty();
            $.get("/Search/GetSubCat", { CategoryId: id }, function (data) {

                //var ss = document.getElementById("CategoryId");
                sessionStorage.setItem('CategoryId', id);

                /*$("#SubCategoryId").empty();
                $.each(data, function (index, row) {
                    $("#SubCategoryId").append("<option value='" + row.SubCategoryId + "'>" + row.SubCategoryName + "</option>")
                });*/
            });
        })
    });

    $(function () {
        $("#txtempname").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/Search/getemp/",
                    //data: "{'ename':'" + request.term + "+'"+ "'cID:' "+id+"'}",
                    data: "{'ename':'" + request.term + "'}",
                    datatype: "json",
                    type: "POST",
                    contentType: "application/json; charset-utf-8",
                    success: function (data) {
                        response($.map(data, function (item) {
                            return item;
                        }))
                    },
                });
            },
            minLenght: 1
        });
    });

    function sesh() {

        console.log(sessionStorage.getItem('CategoryId'));
    }
</script>